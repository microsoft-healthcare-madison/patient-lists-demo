{"version":3,"sources":["components/HeaderPanel.js","api.js","components/FHIRResource.js","components/ListsPanel.js","components/DeveloperPanel.js","components/PatientsPanel.js","components/AttributesPanel.js","App.js","serviceWorker.js","index.js"],"names":["ServerInputForm","props","React","useState","serverRootURL","setServerRootURL","validURL","setValidURL","tagSystem","setTagSystem","tagCode","setTagCode","isSettingsOpen","setIsSettingsOpen","showToken","setShowToken","token","setToken","lockButton","content","icon","minimal","onClick","isOpen","keepChildrenMounted","className","onSubmit","event","preventDefault","setBearerToken","type","value","onChange","target","trim","URL","metadataUrl","replace","fetch","then","catch","e","placeholder","rightElement","onInput","disabled","HeaderPanel","bearerToken","this","developerMessages","setDeveloperMessages","Component","getRefsFrom","bundle","code","resources","entry","map","resource","filter","Boolean","getResources","ch7istics","flatMap","x","characteristic","coding","some","c","system","getCharacteristics","locations","Set","valueReference","reference","sort","drain","resourceUrl","progressCallback","a","bundles","originalProtocol","protocol","url","authorization","headers","Authorization","parsedURL","console","warn","host","href","undefined","response","json","push","newBundle","pop","resourceType","next","link","relation","length","total","filterLists","lists","selections","listsCopy","b","left","name","right","localeCompare","resolvePatients","serverRoot","list","members","member","promises","entity","ref","getPatient","Promise","all","Resource","id","display","getHoverData","hoverContent","attribute","key","style","fontWeight","transitionDuration","intent","boundary","hoverCloseDelay","enforceFocus","ListSelector","selectedList","setSelectedList","handleListSelection","selectedValue","encodeURI","color","rel","actual","ResourceRow","ListsPanel","state","bind","loaded","includes","params","encodedParamString","kv","encodeURIComponent","join","query","stateLocation","validator","getRefreshQueryUrl","newState","included","setState","getDiscoveryUrl","setPatients","requireSummaryDiscovery","discoverLists","refreshResources","refreshData","group","groups","overflowY","DeveloperPanel","messages","isHidden","setIsHidden","zIndex","position","title","patientAttributeGetters","p","patient","officialNames","use","names","given","fn","family","ageMs","Date","now","parse","birthDate","Math","trunc","getUTCFullYear","gender","PatientsPanel","patients","attributeGetters","getters","extraAttributeGetters","columns","condensed","interactive","slice","getter","getRow","row","col","i","ExtraAttributesPanel","what","setColumns","setExtraAttributeGetters","checked","handleAttributeSelected","isChecked","App","setRequireSummaryDiscovery","useEffect","message","d","window","location","hostname","match","DemoApp","strict","StrictMode","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","registration","unregister","error"],"mappings":"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","file":"static/js/main.7b457878.chunk.js","sourcesContent":["import React from 'react';\nimport 'components/HeaderPanel.css'\nimport { Button, Collapse, InputGroup, Tooltip } from \"@blueprintjs/core\";\n\nconst appTitle = \"Patient Lists Demo App\";\n\n// NICE: Remake this as a NavBar: https://blueprintjs.com/docs/#core/components/navbar\n//       The Server Root URL can be part of a Settings Cog, then.\n\n// EASY: add a blueprint Toast when a server entry has been entered and accpeted:\n//       https://blueprintjs.com/docs/#core/components/toast\n\nfunction ServerInputForm(props) {\n  const [serverRootURL, setServerRootURL] = React.useState(props.serverRootURL);\n  const [validURL, setValidURL] = React.useState(true);\n  const [tagSystem, setTagSystem] = React.useState(props.tagSystem);\n  const [tagCode, setTagCode] = React.useState(props.tagCode)\n  const [isSettingsOpen, setIsSettingsOpen] = React.useState(false);\n  const [showToken, setShowToken] = React.useState(false);\n  const [token, setToken] = React.useState('');\n\n  const applySettingsButton = (event) => {\n    event.preventDefault();\n    props.setServerRootURL(serverRootURL);\n    props.setTagCode(tagCode);\n    props.setTagSystem(tagSystem);\n    props.setBearerToken(token);\n  }\n\n  // Updates the input field value as the user enters new values.\n  const serverRootChanged = (event) => {\n    const value = event.target.value.trim();\n    setServerRootURL(value);\n    try {\n      new URL(value);\n      const metadataUrl = (value + '/metadata').replace(/([^:]\\/)\\/+/g, \"$1\");\n      fetch(metadataUrl)\n        .then(() => setValidURL(true))\n        .catch(() => setValidURL(false));\n    } catch(e) {\n      setValidURL(false);\n    }\n  }\n\n  // Updates the input field as the user enters new values.\n  const tagSystemChanged = (event) => {\n    setTagSystem(event.target.value.trim());\n  }\n\n  // Updates the input field as the user enters new values.\n  const tagCodeChanged = (event) => {\n    setTagCode(event.target.value.trim());\n  }\n\n  const lockButton = (\n    <Tooltip content={`${showToken ? \"Hide\" : \"Show\"} Token`}>\n      <Button\n        icon={showToken ? \"unlock\" : \"lock\"}\n        minimal={true}\n        onClick={() => setShowToken(!showToken)}\n      />\n    </Tooltip>\n  );\n\n  const tokenInput = (event) => {\n    setToken(event.target.value);\n  }\n\n  // TODO: replace this homebrewed form with a blueprint FormGroup, maybe.\n  return (\n    <>\n      <Button\n        onClick={ () => { setIsSettingsOpen(!isSettingsOpen); } }\n      >{ isSettingsOpen ? \"Hide\" : \"Show\" } Settings</Button>\n      <Collapse\n        isOpen={isSettingsOpen}\n        keepChildrenMounted={true}\n      >\n        <form className=\"server\" onSubmit={applySettingsButton}>\n          <label>FHIR Server Root</label>\n          &nbsp;\n          <input\n            className=\"url\"\n            type=\"text\"\n            value={serverRootURL}\n            onChange={serverRootChanged}\n          />\n          <br></br>\n          <br></br>\n\n          <label>Authentication</label>\n          <table>\n            <tbody>\n              <tr><td>Bearer Token</td></tr>\n              <tr><td>\n                <InputGroup\n                  placeholder=\"Enter a bearer token...\"\n                  rightElement={lockButton}\n                  type={showToken ? \"text\" : \"token\"}\n                  onInput={tokenInput}\n                />\n              </td></tr>\n            </tbody>\n          </table>\n          <br></br>\n          <br></br>\n\n          <label>Data Tag</label>\n          <table>\n            <tbody>\n              <tr>\n                <td>\n                  <label>system</label>\n                </td>\n                <td>\n                  <input\n                    className=\"url\"\n                    type=\"text\"\n                    value={tagSystem}\n                    onChange={tagSystemChanged}\n                  />\n                </td>\n              </tr>\n              <tr>\n                <td>\n                  <label>code</label>\n                </td>\n                <td>\n                  <input\n                    type=\"text\"\n                    value={tagCode}\n                    onChange={tagCodeChanged}\n                  />\n                </td>\n              </tr>\n            </tbody>\n          </table>\n          <Button type=\"submit\" disabled={!validURL}>Apply</Button>\n        </form>\n      </Collapse>\n    </>\n  );\n}\n\nclass HeaderPanel extends React.Component {\n  // TODO: handle requireSummaryDiscovery here with a checkbox\n  render() {\n    return (\n      <div>\n        <span className=\"app-title\">{appTitle}</span>\n        <ServerInputForm\n          bearerToken={this.props.bearerToken}\n          developerMessages={this.props.developerMessages}\n          serverRootURL={this.props.serverRootURL}\n          setBearerToken={this.props.setBearerToken}\n          setDeveloperMessages={this.props.setDeveloperMessages}\n          setServerRootURL={this.props.setServerRootURL}\n          setTagCode={this.props.setTagCode}\n          setTagSystem={this.props.setTagSystem}\n          tagCode={this.props.tagCode}\n          tagSystem={this.props.tagSystem}\n      />\n      </div>  \n    );\n  }\n}\n\nexport default HeaderPanel;\n","export const codeSystem = \"http://argonautproject.org/patient-lists/CodeSystem/characteristics\";\n\n// Returns the non-empty resources from a bundle.\nfunction getResources(bundle) {\n  return bundle && bundle.entry ? bundle.entry.map(e => e.resource).filter(Boolean) : [];\n}\n\n// Returns the patient list characteristics matching a code (ie 'at-location').\nfunction getCharacteristics(resources, code) {\n  const hasChars = resources.flatMap(x => x.characteristic).filter(Boolean);\n  return hasChars.filter(\n    x => x.code && x.code.coding && x.code.coding.some(\n      c => c.system === codeSystem && c.code === code\n    )\n  );\n}\n\n// Returns the sorted set of code references from lists in a bundle.\nexport function getRefsFrom(bundle, code) {\n  const resources = getResources(bundle);\n  if (!resources) {\n    return [];\n  }\n  const ch7istics = getCharacteristics(resources, code);\n  const locations = new Set(ch7istics.map(x => x.valueReference.reference));\n  return [...locations].sort();\n}\n\n// Returns a de-paginated bundle of resources from an initial URL.\nexport async function drain(resourceUrl, bearerToken, progressCallback) {\n  const bundles = [];\n  const originalProtocol = new URL(resourceUrl).protocol;\n  let url = resourceUrl.replace(/([^:]\\/)\\/+/g, \"$1\");\n  const authorization = {\n    headers: {\n      Authorization: `Bearer ${bearerToken}`\n    }\n  }\n  do {\n    // HACK: fixes https://github.com/microsoft-healthcare-madison/patient-lists-demo/issues/15\n    const parsedURL = new URL(url);\n    if (parsedURL.protocol !== originalProtocol) {\n      console.warn(`\n        Unexpected change of protocol when draining a resource URL!!!\n        Server at ${parsedURL.host} changed from ${originalProtocol} to ${parsedURL.protocol}.\n        Reverting protocol back to ${originalProtocol}!\n      `.replace(/\\s+/g, ' ').trim());\n      parsedURL.protocol = originalProtocol;\n      url = parsedURL.href;\n    }\n    // Fetch a bundle from the URL.\n    await fetch(url, bearerToken ? authorization : undefined)\n      .then(response => response.json())\n      .then(bundle => bundles.push(bundle));\n    const newBundle = bundles.pop();\n    if (newBundle.resourceType !== 'Bundle') {\n      return newBundle;\n    }\n    if (!newBundle.entry) { newBundle.entry = []; }\n\n    // If the search was paginated, prepare to fetch the following bundle.\n    const next = newBundle.link.filter(x => x.relation === 'next');\n    url = next.length ? next[0].url : undefined;\n\n    // Build up the entries in the first bundle to include entries from all.\n    if (bundles.length === 0) {\n      bundles.push(newBundle);\n    } else {\n      bundles[0].entry.push(...newBundle.entry);\n    }\n\n    // Inform the caller of the current progress via callback, if defined.\n    if (progressCallback && bundles.length && bundles[0].entry) {\n      progressCallback(bundles[0].entry.length, bundles[0].total);\n    }\n  } while (url);\n  return bundles[0];\n}\n\n// Returns a list of resources from a bundle based on in-app selections.\nexport function filterLists(lists, selections) {\n  if (!lists) {\n    return [];\n  }\n\n  // Shallow-copy the list.\n  const listsCopy = [...lists];\n\n  // TODO: apply the filter by removing lists that match no selections.\n  if (selections.length) {\n    console.warn('Not Implemented yet: api.filterLists', selections);  // XXX\n  }\n\n  // Sort the remaining lists by name.\n  return listsCopy.sort((a, b) => {\n    const left = a.resource.name || '';\n    const right = b.resource.name || '';\n    return left.localeCompare(right);\n  });\n}\n\n// BUG: This app assumes that a Group's member.entity contains a 'reference' to a patient.\n//      The 'reference' member.entity attribute is technically optional - there are other\n//      ways to represent a reference to a list member.\n//      Maybe a validator can log a warning about that earlier in the UI when encountered\n//      (and fail gracefully).\n\n// Returns the complete list of Patient resources who are members of a list.\nexport function resolvePatients(serverRoot, bearerToken, list) {\n  // Returns the reference for a list member from the list.member fragment.\n  function getReference(member) {\n    if (member && member.entity) {\n      return member.entity.reference;\n    }\n    console.warn('api.resolvePatients.getReference: unknown reference type in:', list, member);\n  }\n\n  async function getPatient(reference) {\n    return drain(serverRoot + '/' + reference, bearerToken);\n  }\n\n  const members = list.member ? list.member : [];\n  const memberRefs = [...new Set(members.map(getReference).filter(x => x))];\n  const promises = memberRefs.map(ref => getPatient(ref));\n  return Promise.all(promises);\n}\n","/*\n  A component that wraps a FHIR resource, enabling a hover-text popup with\n  additional details about the resource.\n\n  <Resource\n    resource={resource}\n    display={resource.name}\n    getHoverData={(resource) => {\n      return [\n        ['id', resource.id],\n        ['url', resource.url],\n        ['name', resource.name],\n      ];\n    }}\n    />\n  \n  NICE\n    [ ] hover-text shows extra details in a *focusable* pop-up panel\n*/\nimport React from 'react'\nimport { Tooltip } from \"@blueprintjs/core\";\n\nexport function Resource(props) {\n  const resource = props.resource;\n  const reference = `${resource.resourceType}/${resource.id}`\n  const display = props.display || reference;\n  const disabled = props.getHoverData ? false : true;\n  let hoverContent = <table/>;  // placeholder\n  if (props.getHoverData) {\n    hoverContent = (\n      <table>\n        <tbody>\n          {\n            props.getHoverData(resource).map(([attribute, value]) => {\n              return (\n                <tr key={`${reference}.${attribute}`}>\n                  <td style={{fontWeight: 'bold'}}>{attribute}</td>\n                  <td>{value}</td>\n                </tr>\n              );\n            })\n          }\n        </tbody>\n      </table>\n    );\n  }\n  // TODO: figure out how to enable the tool-top to be focused when hovered-over.\n  return (\n    <Tooltip\n      content={hoverContent}\n      disabled={disabled}\n      transitionDuration={100}\n      intent=\"primary\"\n      boundary=\"viewport\"\n      hoverCloseDelay={1000}\n      enforceFocus={false}\n    >\n      <span>{display}</span>\n    </Tooltip>\n  );\n}\n","import { drain, filterLists, getRefsFrom, resolvePatients } from 'api';\nimport React from 'react';\nimport { Radio, RadioGroup } from \"@blueprintjs/core\";\nimport { Resource } from 'components/FHIRResource';\n\nconst debug = false;  // XXX\n\n// TODO: move this to a FHIRGroup module?\n// TODO: create a src.components.fhir folder?\n\n// A FHIR Resource in a table row.\nfunction ResourceRow(props) {\n  const resource = props.resource;\n  const key = `${resource.resourceType}/${resource.id}`;\n  return (\n    <Radio\n      key={key}\n      value={key}\n    >\n      <Resource\n        display={resource.name}\n        resource={resource}\n        getHoverData={(resource) => {\n          return [\n            ['reference', (\n              <a\n                href={encodeURI(`${props.serverRootURL}/${key}`)}\n                style={{color: 'yellow'}}\n                rel=\"noopener noreferrer\"\n                target=\"_blank\"\n              >\n                {key}\n              </a>\n            )],\n            ['actual', resource.actual ? 'true' : 'false'],\n            ['type', resource.type],\n            ['members', resource.member ? resource.member.length : '?'],\n            // TODO: add any other relevant hover-text fields here.\n          ];\n        }}\n      />\n    </Radio>\n  );\n}\n\n// A sorted list of patient lists, pre-filtered by the current filter selection.\nfunction ListSelector(props) {\n  // TODO: pull this up to the main panel.\n  const [selectedList, setSelectedList] = React.useState();\n  if (!props.lists) {\n    return <></>;\n  }\n\n  function getList(reference) {\n    return props.lists.filter(\n      (x) => `Group/${x.resource.id}` === reference\n    )[0];\n  }\n\n  return (\n    <RadioGroup\n      onChange={(e) => {\n        setSelectedList(e.target.value);\n        props.handleListSelection(getList(e.target.value).resource);\n      }}\n      selectedValue={selectedList}\n    >{\n        props.lists.map((x) => {\n          return ResourceRow({\n            handleListSelection: props.handleListSelection,\n            resource: x.resource,\n            serverRootURL: props.serverRootURL,\n          });\n        })\n      }\n    </RadioGroup>\n  );\n}\n\n// A panel of selectable patient lists with optional filters.\nclass ListsPanel extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      serverRoot: props.serverRootURL,\n      bearerToken: props.bearerToken,\n      tagCode: props.tagCode,\n      tagSystem: props.tagSystem,\n    };\n    this.handleListSelection = this.handleListSelection.bind(this);\n  }\n\n  // NICE: update something on-screen while data is loading.\n  progressCallback(resourceType, loaded, total) {\n    if (debug) {\n      console.log(`Loaded ${loaded} of ${total} ${resourceType} records`);\n    }\n  }\n\n  // TODO: move this into api.js\n  // Returns a URL to refresh an optionally tagged resource type which may _include other types.\n  getRefreshQueryUrl(resourceType, includes) {\n    const params = [];\n    if (this.props.tagSystem && this.props.tagCode) {\n      params.push(['_tag', `${this.props.tagSystem}|${this.props.tagCode}`]);\n    }\n    if (includes && includes.length) {\n      params.push(...includes.map(x => ['_include', x]));\n    }\n    const encodedParamString = params\n      .map(kv => kv.map(encodeURIComponent).join(\"=\"))\n      .join(\"&\");\n    const query = encodedParamString ? `?${encodedParamString}` : '';\n    return `${this.props.serverRootURL}/${resourceType}${query}`;\n  }\n\n  // Returns a summary of the available lists.\n  getDiscoveryUrl() {\n    const params = [['_summary', 'true']];\n    if (this.props.tagSystem && this.props.tagCode) {\n      params.push(['_tag', `${this.props.tagSystem}|${this.props.tagCode}`]);\n    }\n    const encodedParamString = params\n      .map(kv => kv.map(encodeURIComponent).join(\"=\"))\n      .join(\"&\");\n    const query = encodedParamString ? `?${encodedParamString}` : '';\n    return `${this.props.serverRootURL}/Group${query}`;\n  }\n\n  refreshResources(resourceType, stateLocation, includes, validator) {\n    const url = this.getRefreshQueryUrl(resourceType, includes);\n    drain(url, this.props.bearerToken, (x, total) => { this.progressCallback(resourceType, x, total); })\n      .then((bundle) => {\n        const newState = {};\n        const resources = bundle.entry.filter(e => e.resource.resourceType === resourceType);\n        const included = bundle.entry.filter(e => e.resource.resourceType !== resourceType);\n        newState[stateLocation] = resources;\n        newState[`${stateLocation}Included`] = included;\n        if (validator) {\n          resources.map(x => validator(resourceType, x));\n        }\n        this.setState(newState);\n      });\n  }\n\n  discoverLists() {\n    drain(this.getDiscoveryUrl(), this.props.bearerToken)\n      .then(b => this.setState({ 'groups': b.entry }));\n  }\n\n  refreshData() {\n    this.props.setPatients([]);\n    if (this.props.requireSummaryDiscovery) {\n      this.discoverLists();\n    } else {\n      this.refreshResources('Group', 'groups');\n    }\n    this.refreshResources('Location', 'locations');\n    // NICE: examine the fetched data, logging a warning to DeveloperPanel if any look malformed\n  }\n\n  componentDidMount() {\n    this.refreshData();\n  }\n\n  componentDidUpdate() {\n    // Refresh ALL the cached data when the server component has changed.\n    const needsRefresh =\n      (this.state.serverRoot !== this.props.serverRootURL) ||\n      (this.state.bearerToken !== this.props.bearerToken) ||\n      (this.state.tagCode !== this.props.tagCode) ||\n      (this.state.tagSystem !== this.props.tagSystem);\n\n    if (needsRefresh) {\n      this.refreshData();\n      this.setState({\n        serverRoot: this.props.serverRootURL,\n        bearerToken: this.props.bearerToken,\n        tagCode: this.props.tagCode,\n        tagSystem: this.props.tagSystem,\n      });\n    }\n  }\n\n  handleListSelection(resource) {\n    drain(\n      `${this.props.serverRootURL}/Group/${resource.id}`,\n      this.props.bearerToken\n    ).then(\n      group => resolvePatients(\n        this.props.serverRootURL,\n        this.props.bearerToken,\n        group,\n      ).then(this.props.setPatients)\n    );\n  }\n\n  render() {\n    const lists = this.state.groups;\n    // TODO: group the characteristics selections into one function.\n    const locations = getRefsFrom(lists, 'at-location');\n    const orgs = getRefsFrom(lists, 'attributed-to-organization');\n    const docs = getRefsFrom(lists, 'attributed-to-practitioner');\n    const careTeams = getRefsFrom(lists, 'attributed-to-careteam');\n    // TODO: get the component selections, saving them into an object.\n    // TODO: also collect Orgs and Docs from the ManagingEntity field (either should work).\n    if (debug) {\n      console.log('render selections from', locations, orgs, docs, careTeams);  // XXX\n    }\n    const selections = [];\n\n    // TODO: pass in a hook state for the selectedList and a setter.  This will allow a data refresh to\n    //       un-select the current selected list (which would be needed when changing servers).\n\n    // NICE: turn this into a NavBar: https://blueprintjs.com/docs/#core/components/navbar followed by a scrollable ListSelector\n    return (\n      <>\n        <div style={{ fontWeight: 'bold' }} >\n          Patient Lists ({this.state.groups ? this.state.groups.length : 0})\n        </div>\n        <div style={{ overflowY: 'scroll' }} >\n          <ListSelector\n            handleListSelection={this.handleListSelection}\n            lists={filterLists(lists, selections)}\n            serverRootURL={this.props.serverRootURL}\n            bearerToken={this.props.bearerToken}\n          />\n        </div>\n      </>\n    );\n  }\n}\n\nexport default ListsPanel;","import React from 'react';\nimport 'components/DeveloperPanel.css'\nimport { Button, Callout, Collapse } from \"@blueprintjs/core\";\n\n// NICE: enable this panel to be resized up and down.\n\nexport default function DeveloperPanel(props) {\n  let messages = props.developerMessages || <pre key=\"0\">None</pre>;\n  const [isHidden, setIsHidden] = React.useState(true);\n\n  return (\n    <>\n      <Button\n        onClick={() => {setIsHidden(!isHidden)}}\n        style={{zIndex: 1, position: 'relative'}}\n      >\n        {isHidden ? \"Show\" : \"Hide\"} Developer Messages\n      </Button>\n      <Collapse isOpen={!isHidden}>\n        <Callout title=\"Developer Messages (Most Recent At Top)\">\n          <div style={{overflowY: 'scroll'}}>\n            {messages}\n          </div>\n        </Callout>\n      </Collapse>\n    </>\n  );\n}\n","import React from 'react';\nimport 'components/PatientsPanel.css'\nimport { HTMLTable } from '@blueprintjs/core';\n\n// TODO: decide how to enable the on-hover data for patients, just like in the lists panel\n\nfunction getRow(patient, attributeGetters) {\n  return attributeGetters.map(getter => getter[1](patient));\n}\n\nfunction getData(patients, attributeGetters) {\n  return patients.map(patient => getRow(patient, attributeGetters));\n}\n\nfunction getName(patient) {\n  if (patient && patient.name) {\n    const officialNames = patient.name.filter(name => name.use === 'official');\n    if (officialNames.length) {\n      const name = officialNames[0];\n      const names = name.given.map(fn => `${fn} ${name.family}`);\n      if (names.length) {\n        return names[0].replace(/[0-9]/g, '');\n      }\n    }\n  }\n  return 'J. Doe';\n}\n\nfunction getAge(patient) {\n  const ageMs = Date.now() - Date.parse(patient.birthDate);\n  return Math.trunc(new Date(ageMs).getUTCFullYear() - 1970);\n}\n\nconst patientAttributeGetters = [\n  ['ID', p => p.id],\n  ['Name', getName],\n  ['Age', getAge],\n  ['Sex', p => p.gender === 'female' ? 'F' : 'M'],\n];\n\nexport default function PatientsPanel(props) {\n  const getters = [...patientAttributeGetters, ...props.extraAttributeGetters];\n  const columns = getters.map(x => x[0]);\n  return (\n    <>\n      <div style={{ fontWeight: 'bold' }} >\n        Patients ({props.patients.length} selected)\n      </div>\n      <span style={{ overflowY: 'scroll' }} >\n        <HTMLTable condensed={true} interactive={true}>\n          <thead>\n            <tr key=\"patientsPanelHeaders\">{columns.slice(1).map(x =>\n              <th key={x}>{x}</th>\n            )}</tr>\n          </thead>\n          <tbody>\n            {getData(props.patients, getters).map(row =>\n              <tr key={`patientsPanelPatient/${row[0]}`}>{row.slice(1).map((col, i) =>\n                <td key={`Patient/${row[0]}/${i}`}>{col}</td>\n              )}</tr>\n            )}\n          </tbody>\n        </HTMLTable>\n      </span>\n    </>\n  );\n}\n","import React from 'react';\nimport 'components/AttributesPanel.css'\nimport { Checkbox, HTMLTable } from '@blueprintjs/core';\n\n// NICE: reveal this panel by clicking a Button.\n\nfunction getConditions(patient) {\n  return ['Asthma', 'Fibromyalgia', 'Cancer'];\n}\n\nfunction getLatestEncounter(patient) {\n  return '2020-08-21';\n}\n\nfunction getLastImmunization(patient) {\n  return '2019-12-26';\n}\n\nfunction getLocation(patient) {\n  return 'Ward 1';\n}\n\nfunction getPCP(patient) {\n  // TODO: implement this\n  return 'Dr. Doe';\n}\n\nconst extraAttributeGetters = [\n  ['Conditions', getConditions],\n  ['Current Location', getLocation],\n  ['Last Immunization', getLastImmunization],\n  ['Latest Encounter', getLatestEncounter],\n  ['PCP', getPCP],\n];\n\n// TODO: decide what the tooltip will contain when hovering over the row.\nexport default function ExtraAttributesPanel(props) {\n  // Applies the changes.\n  function handleAttributeSelected(event, what) {\n    const setColumns = props.setExtraAttributeGetters;\n    if (event.target.checked) {\n      setColumns([...props.extraAttributeGetters, what]);\n    } else {\n      setColumns(props.extraAttributeGetters.filter(x => x[0] !== what[0]));\n    }\n  }\n\n  return (\n    <>\n      <div style={{ fontWeight: 'bold' }} >\n        Extra Attributes\n      </div>\n      <span style={{ overflowY: 'scroll' }} >\n        <HTMLTable condensed={true}>\n          <tbody>\n            {extraAttributeGetters\n              .map(x =>\n                <tr key={x[0]}>\n                  <td>\n                    <Checkbox\n                      onChange={(e) => handleAttributeSelected(e, x)}\n                      checked={props.isChecked}\n                    >\n                      {x[0]}\n                    </Checkbox>\n                  </td>\n                </tr>\n              )\n            }\n          </tbody>\n        </HTMLTable>\n      </span>\n    </>\n  );\n}\n","import React, {useState} from 'react';\nimport HeaderPanel from 'components/HeaderPanel';\nimport ListsPanel from 'components/ListsPanel';\nimport DeveloperPanel from 'components/DeveloperPanel';\nimport PatientsPanel from 'components/PatientsPanel';\nimport ExtraAttributesPanel from 'components/AttributesPanel';\n\nimport './App.css';\nimport \"normalize.css\";\nimport '@blueprintjs/icons/lib/css/blueprint-icons.css';\nimport '@blueprintjs/core/lib/css/blueprint.css';\nimport '@blueprintjs/select/lib/css/blueprint-select.css';\n\n// TODO: update this with the public-facing URL, when it's available.\n//const defaultServerRootURL = \"http://localhost:8080/hapi-fhir-jpaserver/fhir/\";\nconst defaultServerRootURL = 'https://hapi.fhir.org/baseR4/';\nconst defaultTagSystem = 'http://hl7.org/Connectathon'\nconst defaultTagCode = '2020-Sep'\n\nfunction App() {\n  const [developerMessages, setDeveloperMessages] = useState([]);\n  const [extraAttributeGetters, setExtraAttributeGetters] = useState([]);\n  const [patients, setPatients] = useState([]);\n  const [serverRootURL, setServerRootURL] = useState(defaultServerRootURL);\n  const [bearerToken, setBearerToken] = useState('');\n  const [tagSystem, setTagSystem] = useState(defaultTagSystem);\n  const [tagCode, setTagCode] = useState(defaultTagCode);\n  const [requireSummaryDiscovery, setRequireSummaryDiscovery] = useState(true);\n\n  React.useEffect(() => {\n    const message = (\n      <pre key={Date.now()}>Updated FHIR Server root to: {serverRootURL}</pre>\n    );\n    setDeveloperMessages(d => [message, ...d]);\n  }, [serverRootURL]);\n\n  return (\n    <div className=\"App\">\n      <div className=\"row\">\n        <div className=\"top\">\n          <HeaderPanel\n            bearerToken={bearerToken}\n            developerMessages={developerMessages}\n            requireSummaryDiscovery={requireSummaryDiscovery}\n            serverRootURL={serverRootURL}\n            setBearerToken={setBearerToken}\n            setDeveloperMessages={setDeveloperMessages}\n            setRequireSummaryDiscovery={setRequireSummaryDiscovery}\n            setServerRootURL={setServerRootURL}\n            setTagCode={setTagCode}\n            setTagSystem={setTagSystem}\n            tagCode={tagCode}\n            tagSystem={tagSystem}\n          /></div>\n      </div>\n\n      <div className=\"row\">\n        <div className=\"left\">\n          <ListsPanel\n            bearerToken={bearerToken}\n            developerMessages={developerMessages}\n            requireSummaryDiscovery={requireSummaryDiscovery}\n            serverRootURL={serverRootURL}\n            setDeveloperMessages={setDeveloperMessages}\n            setPatients={setPatients}\n            tagCode={tagCode}\n            tagSystem={tagSystem}\n          />\n        </div>\n        <div className=\"center\">\n          <PatientsPanel\n            bearerToken={bearerToken}\n            extraAttributeGetters={extraAttributeGetters}\n            patients={patients}\n            setDeveloperMessages={setDeveloperMessages}\n          />\n        </div>\n        <div className=\"right\">\n          <ExtraAttributesPanel\n            bearerToken={bearerToken}\n            extraAttributeGetters={extraAttributeGetters}\n            setExtraAttributeGetters={setExtraAttributeGetters}\n          />\n        </div>\n      </div>\n\n      <div className=\"row\">\n        <div className=\"bottom\">\n          <DeveloperPanel\n            developerMessages={developerMessages}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\n// Returns a DemoApp either in strict or 'normal' mode.\nfunction DemoApp(props) {\n  if (props.strict) {\n    return (\n      <React.StrictMode>\n        <App />\n      </React.StrictMode>\n    );\n  }\n  return <App />;\n}\n\nReactDOM.render(\n  <DemoApp strict={false} />,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}