(this["webpackJsonppatient-lists-demo"]=this["webpackJsonppatient-lists-demo"]||[]).push([[0],{135:function(e,t,n){e.exports=n(180)},140:function(e,t,n){},141:function(e,t,n){},172:function(e,t,n){},173:function(e,t,n){},174:function(e,t,n){},175:function(e,t,n){},180:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(13),c=n.n(o),s=(n(140),n(16)),l=n(10),i=n(41),u=n(42),m=n(45),p=n(44),f=(n(141),n(11));function d(e){var t=r.a.useState(e.serverRootURL),n=Object(l.a)(t,2),a=n[0],o=n[1],c=r.a.useState(!0),s=Object(l.a)(c,2),i=s[0],u=s[1],m=r.a.useState(e.tagSystem),p=Object(l.a)(m,2),d=p[0],v=p[1],h=r.a.useState(e.tagCode),g=Object(l.a)(h,2),y=g[0],b=g[1],E=r.a.useState(!1),S=Object(l.a)(E,2),R=S[0],C=S[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(f.Button,{onClick:function(){C(!R)}},R?"Hide":"Show"," Settings"),r.a.createElement(f.Collapse,{isOpen:R,keepChildrenMounted:!0},r.a.createElement("form",{className:"server",onSubmit:function(t){t.preventDefault(),e.setServerRootURL(a),e.setTagCode(y),e.setTagSystem(d)}},r.a.createElement("label",null,"FHIR Server Root"),"\xa0",r.a.createElement("input",{className:"url",type:"text",value:a,onChange:function(e){var t=e.target.value.trim();o(t);try{new URL(t),fetch(t+"/CapabilityStatement").then((function(){return u(!0)})).catch((function(){return u(!1)}))}catch(n){u(!1)}}}),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("label",null,"Data Tag"),r.a.createElement("table",null,r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement("label",null,"system")),r.a.createElement("td",null,r.a.createElement("input",{className:"url",type:"text",value:d,onChange:function(e){v(e.target.value.trim())}}))),r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement("label",null,"code")),r.a.createElement("td",null,r.a.createElement("input",{type:"text",value:y,onChange:function(e){b(e.target.value.trim())}}))))),r.a.createElement(f.Button,{type:"submit",disabled:!i},"Apply"))))}var v=function(e){Object(m.a)(n,e);var t=Object(p.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("span",{className:"app-title"},"Patient Lists Demo App"),r.a.createElement(d,{developerMessages:this.props.developerMessages,serverRootURL:this.props.serverRootURL,setDeveloperMessages:this.props.setDeveloperMessages,setServerRootURL:this.props.setServerRootURL,setTagCode:this.props.setTagCode,setTagSystem:this.props.setTagSystem,tagCode:this.props.tagCode,tagSystem:this.props.tagSystem}))}}]),n}(r.a.Component),h=n(43),g=n(51),y=n.n(g),b=n(81);function E(e,t){var n=function(e){return e&&e.entry?e.entry.map((function(e){return e.resource})).filter(Boolean):[]}(e);if(!n)return[];var a=function(e,t){return e.flatMap((function(e){return e.characteristic})).filter(Boolean).filter((function(e){return e.code&&e.code.coding&&e.code.coding.some((function(e){return"http://argonautproject.org/patient-lists/CodeSystem/characteristics"===e.system&&e.code===t}))}))}(n,t),r=new Set(a.map((function(e){return e.valueReference.reference})));return Object(s.a)(r).sort()}function S(){return(S=Object(b.a)(y.a.mark((function e(t,n){var a,r,o,c,l;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],r=t;case 2:return e.next=4,fetch(r).then((function(e){return e.json()})).then((function(e){return a.push(e)}));case 4:(o=a.pop()).entry||(o.entry=[]),c=o.link.filter((function(e){return"next"===e.relation})),r=c.length?c[0].url:void 0,0===a.length?a.push(o):(l=a[0].entry).push.apply(l,Object(s.a)(o.entry)),n&&a.length&&a[0].entry&&n(a[0].entry.length,a[0].total);case 10:if(r){e.next=2;break}case 11:return e.abrupt("return",a[0]);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e,t){var n=Object(s.a)(e);return t.length&&console.warn("Not Implemented yet: api.filterLists",t),n.sort((function(e,t){var n=e.resource.name||"",a=t.resource.name||"";return n.localeCompare(a)}))}function C(e){var t=e.resource,n="".concat(t.resourceType,"/").concat(t.id),a=e.display||n,o=!e.getHoverData,c=r.a.createElement("table",null);return e.getHoverData&&(c=r.a.createElement("table",null,r.a.createElement("tbody",null,e.getHoverData(t).map((function(e){var t=Object(l.a)(e,2),a=t[0],o=t[1];return r.a.createElement("tr",{key:"".concat(n,".").concat(a)},r.a.createElement("td",{style:{fontWeight:"bold"}},a),r.a.createElement("td",null,o))}))))),r.a.createElement(f.Tooltip,{content:c,disabled:o,transitionDuration:100,intent:"primary",boundary:"viewport",hoverCloseDelay:1e3,enforceFocus:!1},r.a.createElement("span",null,a))}function j(e){var t=r.a.useState(),n=Object(l.a)(t,2),a=n[0],o=n[1];if(!e.lists)return r.a.createElement(r.a.Fragment,null);return r.a.createElement(f.RadioGroup,{onChange:function(t){var n;o(t.target.value),e.handleListSelection((n=t.target.value,e.lists.filter((function(e){return"Group/".concat(e.resource.id)===n}))[0]).resource)},selectedValue:a},e.lists.map((function(t){return function(e){var t=e.resource,n="".concat(t.resourceType,"/").concat(t.id);return r.a.createElement(f.Radio,{key:n,value:n},r.a.createElement(C,{display:t.name,resource:t,getHoverData:function(t){return[["reference",r.a.createElement("a",{href:encodeURI("".concat(e.serverRootURL,"/").concat(n)),style:{color:"yellow"},rel:"noopener noreferrer",target:"_blank"},n)],["actual",t.actual?"true":"false"],["type",t.type],["members",t.member?t.member.length:0]]}}))}({handleListSelection:e.handleListSelection,resource:t.resource,serverRootURL:e.serverRootURL})})))}var O=function(e){Object(m.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={groups:[],groupsIncluded:[],locations:[],locationsIncluded:[],serverRoot:e.serverRootURL,tagCode:e.tagCode,tagSystem:e.tagSystem},a.handleListSelection=a.handleListSelection.bind(Object(h.a)(a)),a}return Object(u.a)(n,[{key:"progressCallback",value:function(e,t,n){0}},{key:"getRefreshQueryUrl",value:function(e,t){var n=[];this.props.tagSystem&&this.props.tagCode&&n.push(["_tag","".concat(this.props.tagSystem,"|").concat(this.props.tagCode)]),t&&t.length&&n.push.apply(n,Object(s.a)(t.map((function(e){return["_include",e]}))));var a=n.map((function(e){return e.map(encodeURIComponent).join("=")})).join("&"),r=a?"?".concat(a):"";return"".concat(this.props.serverRootURL,"/").concat(e).concat(r)}},{key:"refreshResources",value:function(e,t,n,a){var r=this;(function(e,t){return S.apply(this,arguments)})(this.getRefreshQueryUrl(e,n),(function(t,n){r.progressCallback(e,t,n)})).then((function(n){var o={},c=n.entry.filter((function(t){return t.resource.resourceType===e})),s=n.entry.filter((function(t){return t.resource.resourceType!==e}));o[t]=c,o["".concat(t,"Included")]=s,a&&c.map((function(t){return a(e,t)})),r.setState(o)}))}},{key:"refreshData",value:function(){this.props.setPatients([]),this.refreshResources("Group","groups",["Group:member"]),this.refreshResources("Location","locations")}},{key:"componentDidMount",value:function(){this.refreshData()}},{key:"componentDidUpdate",value:function(){(this.state.serverRoot!==this.props.serverRootURL||this.state.tagCode!==this.props.tagCode||this.state.tagSystem!==this.props.tagSystem)&&(this.refreshData(),this.setState({serverRoot:this.props.serverRootURL,tagCode:this.props.tagCode,tagSystem:this.props.tagSystem}))}},{key:"resolvePatients",value:function(e,t){var n=e.member?e.member:[],a=new Set(n.map((function(t){if(t&&t.entity)return t.entity.reference;console.log("resolvePatients.getReference: unknown reference type in:",e)})).filter((function(e){return e})));return t.map((function(e){return e.resource})).filter((function(e){return a.has("".concat(e.resourceType,"/").concat(e.id))}))}},{key:"handleListSelection",value:function(e){e.member?this.props.setPatients(this.resolvePatients(e,this.state.groupsIncluded)):this.props.setPatients([])}},{key:"render",value:function(){var e=this.state.groups;E(e,"at-location"),E(e,"attributed-to-organization"),E(e,"attributed-to-practitioner"),E(e,"attributed-to-careteam");return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{fontWeight:"bold"}},"Patient Lists (",this.state.groups.length,")"),r.a.createElement("div",{style:{overflowY:"scroll"}},r.a.createElement(j,{handleListSelection:this.handleListSelection,lists:R(e,[]),serverRootURL:this.props.serverRootURL})))}}]),n}(r.a.Component);n(172);function k(e){var t=e.developerMessages||r.a.createElement("pre",{key:"0"},"None"),n=r.a.useState(!0),a=Object(l.a)(n,2),o=a[0],c=a[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(f.Button,{onClick:function(){c(!o)},style:{zIndex:1,position:"relative"}},o?"Show":"Hide"," Developer Messages"),r.a.createElement(f.Collapse,{isOpen:!o},r.a.createElement(f.Callout,{title:"Developer Messages (Most Recent At Top)"},r.a.createElement("div",{style:{overflowY:"scroll"}},t))))}n(173);var L=[["ID",function(e){return e.id}],["Name",function(e){if(e&&e.name){var t=e.name.filter((function(e){return"official"===e.use}));if(t.length){var n=t[0],a=n.given.map((function(e){return"".concat(e," ").concat(n.family)}));if(a.length)return a[0].replace(/[0-9]/g,"")}}return"J. Doe"}],["Age",function(e){var t=Date.now()-Date.parse(e.birthDate);return Math.trunc(new Date(t).getUTCFullYear()-1970)}],["Sex",function(e){return"female"===e.gender?"F":"M"}]];function D(e){var t,n,a=[].concat(L,Object(s.a)(e.extraAttributeGetters)),o=a.map((function(e){return e[0]}));return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{fontWeight:"bold"}},"Patients (",e.patients.length," selected)"),r.a.createElement("span",{style:{overflowY:"scroll"}},r.a.createElement(f.HTMLTable,{condensed:!0,interactive:!0},r.a.createElement("thead",null,r.a.createElement("tr",{key:"patientsPanelHeaders"},o.slice(1).map((function(e){return r.a.createElement("th",{key:e},e)})))),r.a.createElement("tbody",null,(t=e.patients,n=a,t.map((function(e){return function(e,t){return t.map((function(t){return t[1](e)}))}(e,n)}))).map((function(e){return r.a.createElement("tr",{key:"patientsPanelPatient/".concat(e[0])},e.slice(1).map((function(t,n){return r.a.createElement("td",{key:"Patient/".concat(e[0],"/").concat(n)},t)})))}))))))}n(174);var w=[["Conditions",function(e){return["Asthma","Fibromyalgia","Cancer"]}],["Current Location",function(e){return"Ward 1"}],["Last Immunization",function(e){return"2019-12-26"}],["Latest Encounter",function(e){return"2020-08-21"}],["PCP",function(e){return"Dr. Doe"}]];function U(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{fontWeight:"bold"}},"Extra Attributes"),r.a.createElement("span",{style:{overflowY:"scroll"}},r.a.createElement(f.HTMLTable,{condensed:!0},r.a.createElement("tbody",null,w.map((function(t){return r.a.createElement("tr",{key:t[0]},r.a.createElement("td",null,r.a.createElement(f.Checkbox,{onChange:function(n){return function(t,n){var a=e.setExtraAttributeGetters;t.target.checked?a([].concat(Object(s.a)(e.extraAttributeGetters),[n])):a(e.extraAttributeGetters.filter((function(e){return e[0]!==n[0]})))}(n,t)},checked:e.isChecked},t[0])))}))))))}n(175),n(176),n(177),n(178),n(179);var M=function(){var e=Object(a.useState)([]),t=Object(l.a)(e,2),n=t[0],o=t[1],c=Object(a.useState)([]),i=Object(l.a)(c,2),u=i[0],m=i[1],p=Object(a.useState)([]),f=Object(l.a)(p,2),d=f[0],h=f[1],g=Object(a.useState)("http://localhost:8080/hapi-fhir-jpaserver/fhir/"),y=Object(l.a)(g,2),b=y[0],E=y[1],S=Object(a.useState)(""),R=Object(l.a)(S,2),C=R[0],j=R[1],L=Object(a.useState)(""),w=Object(l.a)(L,2),M=w[0],T=w[1];return r.a.useEffect((function(){var e=r.a.createElement("pre",{key:Date.now()},"Updated FHIR Server root to: ",b);o((function(t){return[e].concat(Object(s.a)(t))}))}),[b]),r.a.createElement("div",{className:"App"},r.a.createElement("div",{id:"headerPanel"},r.a.createElement("div",{className:"top"},r.a.createElement(v,{developerMessages:n,serverRootURL:b,setDeveloperMessages:o,setServerRootURL:E,setTagCode:T,setTagSystem:j,tagCode:M,tagSystem:C}))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"left"},r.a.createElement(O,{developerMessages:n,serverRootURL:b,setDeveloperMessages:o,setPatients:h,tagCode:M,tagSystem:C})),r.a.createElement("div",{className:"center"},r.a.createElement(D,{extraAttributeGetters:u,patients:d,setDeveloperMessages:o})),r.a.createElement("div",{className:"right"},r.a.createElement(U,{extraAttributeGetters:u,setExtraAttributeGetters:m}))),r.a.createElement("div",{id:"footerPanel"},r.a.createElement("div",{className:"bottom"},r.a.createElement(k,{developerMessages:n}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function T(e){return e.strict?r.a.createElement(r.a.StrictMode,null,r.a.createElement(M,null)):r.a.createElement(M,null)}c.a.render(r.a.createElement(T,{strict:!1}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[135,1,2]]]);
//# sourceMappingURL=main.92f6242e.chunk.js.map