{"version":3,"sources":["components/HeaderPanel.js","api.js","components/FHIRResource.js","components/ListsPanel.js","components/DeveloperPanel.js","components/PatientsPanel.js","components/AttributesPanel.js","App.js","serviceWorker.js","index.js"],"names":["ServerInputForm","props","React","useState","serverRootURL","setServerRootURL","validURL","setValidURL","tagSystem","setTagSystem","tagCode","setTagCode","isSettingsOpen","setIsSettingsOpen","showPassword","setShowPassword","token","setToken","lockButton","content","icon","minimal","onClick","isOpen","keepChildrenMounted","className","onSubmit","event","preventDefault","setBearerToken","type","value","onChange","target","trim","URL","fetch","then","catch","e","placeholder","rightElement","onInput","disabled","HeaderPanel","bearerToken","this","developerMessages","setDeveloperMessages","Component","getRefsFrom","bundle","code","resources","entry","map","resource","filter","Boolean","getResources","ch7istics","flatMap","x","characteristic","coding","some","c","system","getCharacteristics","locations","Set","valueReference","reference","sort","drain","resourceUrl","progressCallback","a","bundles","url","authorization","headers","Authorization","undefined","response","json","push","newBundle","pop","resourceType","next","link","relation","length","total","filterLists","lists","selections","listsCopy","console","warn","b","left","name","right","localeCompare","resolvePatients","serverRoot","list","members","member","promises","entity","ref","getPatient","Promise","all","Resource","id","display","getHoverData","hoverContent","attribute","key","style","fontWeight","transitionDuration","intent","boundary","hoverCloseDelay","enforceFocus","ListSelector","selectedList","setSelectedList","handleListSelection","selectedValue","href","encodeURI","color","rel","actual","ResourceRow","ListsPanel","state","bind","loaded","includes","params","encodedParamString","kv","encodeURIComponent","join","query","stateLocation","validator","getRefreshQueryUrl","newState","included","setState","getDiscoveryUrl","setPatients","requireSummaryDiscovery","discoverLists","refreshResources","refreshData","groups","overflowY","DeveloperPanel","messages","isHidden","setIsHidden","zIndex","position","title","patientAttributeGetters","p","patient","officialNames","use","names","given","fn","family","replace","ageMs","Date","now","parse","birthDate","Math","trunc","getUTCFullYear","gender","PatientsPanel","patients","attributeGetters","getters","extraAttributeGetters","columns","condensed","interactive","slice","getter","getRow","row","col","i","ExtraAttributesPanel","what","setColumns","setExtraAttributeGetters","checked","handleAttributeSelected","isChecked","App","setRequireSummaryDiscovery","useEffect","message","d","window","location","hostname","match","DemoApp","strict","StrictMode","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","registration","unregister","error"],"mappings":"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","file":"static/js/main.75a41c44.chunk.js","sourcesContent":["import React from 'react';\nimport 'components/HeaderPanel.css'\nimport { Button, Collapse, InputGroup, Tooltip } from \"@blueprintjs/core\";\n\nconst appTitle = \"Patient Lists Demo App\";\n\n// NICE: Remake this as a NavBar: https://blueprintjs.com/docs/#core/components/navbar\n//       The Server Root URL can be part of a Settings Cog, then.\n\n// EASY: add a blueprint Toast when a server entry has been entered and accpeted:\n//       https://blueprintjs.com/docs/#core/components/toast\n\nfunction ServerInputForm(props) {\n  const [serverRootURL, setServerRootURL] = React.useState(props.serverRootURL);\n  const [validURL, setValidURL] = React.useState(true);\n  const [tagSystem, setTagSystem] = React.useState(props.tagSystem);\n  const [tagCode, setTagCode] = React.useState(props.tagCode)\n  const [isSettingsOpen, setIsSettingsOpen] = React.useState(false);\n  const [showPassword, setShowPassword] = React.useState(false);\n  const [token, setToken] = React.useState('');\n\n  const applySettingsButton = (event) => {\n    event.preventDefault();\n    props.setServerRootURL(serverRootURL);\n    props.setTagCode(tagCode);\n    props.setTagSystem(tagSystem);\n    props.setBearerToken(token);\n  }\n\n  // Updates the input field value as the user enters new values.\n  const serverRootChanged = (event) => {\n    const value = event.target.value.trim();\n    setServerRootURL(value);\n    try {\n      new URL(value);\n      fetch(value + '/metadata')\n        .then(() => setValidURL(true))\n        .catch(() => setValidURL(false));\n    } catch(e) {\n      setValidURL(false);\n    }\n  }\n\n  // Updates the input field as the user enters new values.\n  const tagSystemChanged = (event) => {\n    setTagSystem(event.target.value.trim());\n  }\n\n  // Updates the input field as the user enters new values.\n  const tagCodeChanged = (event) => {\n    setTagCode(event.target.value.trim());\n  }\n\n  const lockButton = (\n    <Tooltip content={`${showPassword ? \"Hide\" : \"Show\"} Password`}>\n      <Button\n        icon={showPassword ? \"unlock\" : \"lock\"}\n        minimal={true}\n        onClick={() => setShowPassword(!showPassword)}\n      />\n    </Tooltip>\n  );\n\n  const tokenInput = (event) => {\n    setToken(event.target.value);\n  }\n\n  // TODO: replace this homebrewed form with a blueprint FormGroup, maybe.\n  return (\n    <>\n      <Button\n        onClick={ () => { setIsSettingsOpen(!isSettingsOpen); } }\n      >{ isSettingsOpen ? \"Hide\" : \"Show\" } Settings</Button>\n      <Collapse\n        isOpen={isSettingsOpen}\n        keepChildrenMounted={true}\n      >\n        <form className=\"server\" onSubmit={applySettingsButton}>\n          <label>FHIR Server Root</label>\n          &nbsp;\n          <input\n            className=\"url\"\n            type=\"text\"\n            value={serverRootURL}\n            onChange={serverRootChanged}\n          />\n          <br></br>\n          <br></br>\n\n          <label>Authentication</label>\n          <table>\n            <tbody>\n              <tr><td>Bearer Token</td></tr>\n              <tr><td>\n                <InputGroup\n                  placeholder=\"Enter a bearer token...\"\n                  rightElement={lockButton}\n                  type={showPassword ? \"text\" : \"password\"}\n                  onInput={tokenInput}\n                />\n              </td></tr>\n            </tbody>\n          </table>\n          <br></br>\n          <br></br>\n\n          <label>Data Tag</label>\n          <table>\n            <tbody>\n              <tr>\n                <td>\n                  <label>system</label>\n                </td>\n                <td>\n                  <input\n                    className=\"url\"\n                    type=\"text\"\n                    value={tagSystem}\n                    onChange={tagSystemChanged}\n                  />\n                </td>\n              </tr>\n              <tr>\n                <td>\n                  <label>code</label>\n                </td>\n                <td>\n                  <input\n                    type=\"text\"\n                    value={tagCode}\n                    onChange={tagCodeChanged}\n                  />\n                </td>\n              </tr>\n            </tbody>\n          </table>\n          <Button type=\"submit\" disabled={!validURL}>Apply</Button>\n        </form>\n      </Collapse>\n    </>\n  );\n}\n\nclass HeaderPanel extends React.Component {\n  // TODO: handle requireSummaryDiscovery here with a checkbox\n  render() {\n    return (\n      <div>\n        <span className=\"app-title\">{appTitle}</span>\n        <ServerInputForm\n          bearerToken={this.props.bearerToken}\n          developerMessages={this.props.developerMessages}\n          serverRootURL={this.props.serverRootURL}\n          setBearerToken={this.props.setBearerToken}\n          setDeveloperMessages={this.props.setDeveloperMessages}\n          setServerRootURL={this.props.setServerRootURL}\n          setTagCode={this.props.setTagCode}\n          setTagSystem={this.props.setTagSystem}\n          tagCode={this.props.tagCode}\n          tagSystem={this.props.tagSystem}\n      />\n      </div>  \n    );\n  }\n}\n\nexport default HeaderPanel;\n","export const codeSystem = \"http://argonautproject.org/patient-lists/CodeSystem/characteristics\";\n\n// Returns the non-empty resources from a bundle.\nfunction getResources(bundle) {\n  return bundle && bundle.entry ? bundle.entry.map(e => e.resource).filter(Boolean) : [];\n}\n\n// Returns the patient list characteristics matching a code (ie 'at-location').\nfunction getCharacteristics(resources, code) {\n  const hasChars = resources.flatMap(x => x.characteristic).filter(Boolean);\n  return hasChars.filter(\n    x => x.code && x.code.coding && x.code.coding.some(\n      c => c.system === codeSystem && c.code === code\n    )\n  );\n}\n\n// Returns the sorted set of code references from lists in a bundle.\nexport function getRefsFrom(bundle, code) {\n  const resources = getResources(bundle);\n  if (!resources) {\n    return [];\n  }\n  const ch7istics = getCharacteristics(resources, code);\n  const locations = new Set(ch7istics.map(x => x.valueReference.reference));\n  return [...locations].sort();\n}\n\n// Returns a de-paginated bundle of resources from an initial URL.\nexport async function drain(resourceUrl, bearerToken, progressCallback) {\n  const bundles = [];\n  let url = resourceUrl;\n  const authorization = {\n    headers: {\n      Authorization: `Bearer ${bearerToken}`\n    }\n  }\n  do {\n    // Fetch a bundle from the URL.\n    await fetch(url, bearerToken ? authorization : undefined)\n      .then(response => response.json())\n      .then(bundle => bundles.push(bundle));\n    const newBundle = bundles.pop();\n    if (newBundle.resourceType !== 'Bundle') {\n      return newBundle;\n    }\n    if (!newBundle.entry) { newBundle.entry = []; }\n\n    // If the search was paginated, prepare to fetch the following bundle.\n    const next = newBundle.link.filter(x => x.relation === 'next');\n    url = next.length ? next[0].url : undefined;\n\n    // Build up the entries in the first bundle to include entries from all.\n    if (bundles.length === 0) {\n      bundles.push(newBundle);\n    } else {\n      bundles[0].entry.push(...newBundle.entry);\n    }\n\n    // Inform the caller of the current progress via callback, if defined.\n    if (progressCallback && bundles.length && bundles[0].entry) {\n      progressCallback(bundles[0].entry.length, bundles[0].total);\n    }\n  } while (url);\n  return bundles[0];\n}\n\n// Returns a list of resources from a bundle based on in-app selections.\nexport function filterLists(lists, selections) {\n  if (!lists) {\n    return [];\n  }\n\n  // Shallow-copy the list.\n  const listsCopy = [...lists];\n\n  // TODO: apply the filter by removing lists that match no selections.\n  if (selections.length) {\n    console.warn('Not Implemented yet: api.filterLists', selections);  // XXX\n  }\n\n  // Sort the remaining lists by name.\n  return listsCopy.sort((a, b) => {\n    const left = a.resource.name || '';\n    const right = b.resource.name || '';\n    return left.localeCompare(right);\n  });\n}\n\n// BUG: This app assumes that a Group's member.entity contains a 'reference' to a patient.\n//      The 'reference' member.entity attribute is technically optional - there are other\n//      ways to represent a reference to a list member.\n//      Maybe a validator can log a warning about that earlier in the UI when encountered\n//      (and fail gracefully).\n\n// Returns the complete list of Patient resources who are members of a list.\nexport function resolvePatients(serverRoot, bearerToken, list) {\n  // Returns the reference for a list member from the list.member fragment.\n  function getReference(member) {\n    if (member && member.entity) {\n      return member.entity.reference;\n    }\n    console.warn('api.resolvePatients.getReference: unknown reference type in:', list, member);\n  }\n\n  async function getPatient(reference) {\n    return drain(serverRoot + reference, bearerToken);\n  }\n\n  const members = list.member ? list.member : [];\n  const memberRefs = [...new Set(members.map(getReference).filter(x => x))];\n  const promises = memberRefs.map(ref => getPatient(ref));\n  return Promise.all(promises);\n}\n","/*\n  A component that wraps a FHIR resource, enabling a hover-text popup with\n  additional details about the resource.\n\n  <Resource\n    resource={resource}\n    display={resource.name}\n    getHoverData={(resource) => {\n      return [\n        ['id', resource.id],\n        ['url', resource.url],\n        ['name', resource.name],\n      ];\n    }}\n    />\n  \n  NICE\n    [ ] hover-text shows extra details in a *focusable* pop-up panel\n*/\nimport React from 'react'\nimport { Tooltip } from \"@blueprintjs/core\";\n\nexport function Resource(props) {\n  const resource = props.resource;\n  const reference = `${resource.resourceType}/${resource.id}`\n  const display = props.display || reference;\n  const disabled = props.getHoverData ? false : true;\n  let hoverContent = <table/>;  // placeholder\n  if (props.getHoverData) {\n    hoverContent = (\n      <table>\n        <tbody>\n          {\n            props.getHoverData(resource).map(([attribute, value]) => {\n              return (\n                <tr key={`${reference}.${attribute}`}>\n                  <td style={{fontWeight: 'bold'}}>{attribute}</td>\n                  <td>{value}</td>\n                </tr>\n              );\n            })\n          }\n        </tbody>\n      </table>\n    );\n  }\n  // TODO: figure out how to enable the tool-top to be focused when hovered-over.\n  return (\n    <Tooltip\n      content={hoverContent}\n      disabled={disabled}\n      transitionDuration={100}\n      intent=\"primary\"\n      boundary=\"viewport\"\n      hoverCloseDelay={1000}\n      enforceFocus={false}\n    >\n      <span>{display}</span>\n    </Tooltip>\n  );\n}\n","import { drain, getRefsFrom, filterLists, resolvePatients } from 'api';\nimport React from 'react';\nimport { Radio, RadioGroup } from \"@blueprintjs/core\";\nimport { Resource } from 'components/FHIRResource';\n\nconst debug = false;  // XXX\n\n// TODO: move this to a FHIRGroup module?\n// TODO: create a src.components.fhir folder?\n\n// A FHIR Resource in a table row.\nfunction ResourceRow(props) {\n  const resource = props.resource;\n  const key = `${resource.resourceType}/${resource.id}`;\n  return (\n    <Radio\n      key={key}\n      value={key}\n    >\n      <Resource\n        display={resource.name}\n        resource={resource}\n        getHoverData={(resource) => {\n          return [\n            ['reference', (\n              <a\n                href={encodeURI(`${props.serverRootURL}/${key}`)}\n                style={{color: 'yellow'}}\n                rel=\"noopener noreferrer\"\n                target=\"_blank\"\n              >\n                {key}\n              </a>\n            )],\n            ['actual', resource.actual ? 'true' : 'false'],\n            ['type', resource.type],\n            ['members', resource.member ? resource.member.length : '?'],\n            // TODO: add any other relevant hover-text fields here.\n          ];\n        }}\n      />\n    </Radio>\n  );\n}\n\n// A sorted list of patient lists, pre-filtered by the current filter selection.\nfunction ListSelector(props) {\n  // TODO: pull this up to the main panel.\n  const [selectedList, setSelectedList] = React.useState();\n  if (!props.lists) {\n    return <></>;\n  }\n\n  function getList(reference) {\n    return props.lists.filter(\n      (x) => `Group/${x.resource.id}` === reference\n    )[0];\n  }\n\n  return (\n    <RadioGroup\n      onChange={(e) => {\n        setSelectedList(e.target.value);\n        props.handleListSelection(getList(e.target.value).resource);\n      }}\n      selectedValue={selectedList}\n    >{\n        props.lists.map((x) => {\n          return ResourceRow({\n            handleListSelection: props.handleListSelection,\n            resource: x.resource,\n            serverRootURL: props.serverRootURL,\n          });\n        })\n      }\n    </RadioGroup>\n  );\n}\n\n// A panel of selectable patient lists with optional filters.\nclass ListsPanel extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      serverRoot: props.serverRootURL,\n      bearerToken: props.bearerToken,\n      tagCode: props.tagCode,\n      tagSystem: props.tagSystem,\n    };\n    this.handleListSelection = this.handleListSelection.bind(this);\n  }\n\n  // NICE: update something on-screen while data is loading.\n  progressCallback(resourceType, loaded, total) {\n    if (debug) {\n      console.log(`Loaded ${loaded} of ${total} ${resourceType} records`);\n    }\n  }\n\n  // TODO: move this into api.js\n  // Returns a URL to refresh an optionally tagged resource type which may _include other types.\n  getRefreshQueryUrl(resourceType, includes) {\n    const params = [];\n    if (this.props.tagSystem && this.props.tagCode) {\n      params.push(['_tag', `${this.props.tagSystem}|${this.props.tagCode}`]);\n    }\n    if (includes && includes.length) {\n      params.push(...includes.map(x => ['_include', x]));\n    }\n    const encodedParamString = params\n      .map(kv => kv.map(encodeURIComponent).join(\"=\"))\n      .join(\"&\");\n    const query = encodedParamString ? `?${encodedParamString}` : '';\n    return `${this.props.serverRootURL}/${resourceType}${query}`;\n  }\n\n  // Returns a summary of the available lists.\n  getDiscoveryUrl() {\n    const params = [['_summary', 'true']];\n    if (this.props.tagSystem && this.props.tagCode) {\n      params.push(['_tag', `${this.props.tagSystem}|${this.props.tagCode}`]);\n    }\n    const encodedParamString = params\n      .map(kv => kv.map(encodeURIComponent).join(\"=\"))\n      .join(\"&\");\n    const query = encodedParamString ? `?${encodedParamString}` : '';\n    return `${this.props.serverRootURL}/Group${query}`;\n  }\n\n  refreshResources(resourceType, stateLocation, includes, validator) {\n    const url = this.getRefreshQueryUrl(resourceType, includes);\n    drain(url, this.props.bearerToken, (x, total) => { this.progressCallback(resourceType, x, total); })\n      .then((bundle) => {\n        const newState = {};\n        const resources = bundle.entry.filter(e => e.resource.resourceType === resourceType);\n        const included = bundle.entry.filter(e => e.resource.resourceType !== resourceType);\n        newState[stateLocation] = resources;\n        newState[`${stateLocation}Included`] = included;\n        if (validator) {\n          resources.map(x => validator(resourceType, x));\n        }\n        this.setState(newState);\n      });\n  }\n\n  discoverLists() {\n    drain(this.getDiscoveryUrl(), this.props.bearerToken)\n      .then(b => this.setState({ 'groups': b.entry }));\n  }\n\n  refreshData() {\n    this.props.setPatients([]);\n    if (this.props.requireSummaryDiscovery) {\n      this.discoverLists();\n    } else {\n      this.refreshResources('Group', 'groups');\n    }\n    this.refreshResources('Location', 'locations');\n    // NICE: examine the fetched data, logging a warning to DeveloperPanel if any look malformed\n  }\n\n  componentDidMount() {\n    this.refreshData();\n  }\n\n  componentDidUpdate() {\n    // Refresh ALL the cached data when the server component has changed.\n    const needsRefresh =\n      (this.state.serverRoot !== this.props.serverRootURL) ||\n      (this.state.bearerToken !== this.props.bearerToken) ||\n      (this.state.tagCode !== this.props.tagCode) ||\n      (this.state.tagSystem !== this.props.tagSystem);\n\n    if (needsRefresh) {\n      this.refreshData();\n      this.setState({\n        serverRoot: this.props.serverRootURL,\n        bearerToken: this.props.bearerToken,\n        tagCode: this.props.tagCode,\n        tagSystem: this.props.tagSystem,\n      });\n    }\n  }\n\n  handleListSelection(resource) {\n    if (!resource.member) {\n      this.props.setPatients([]);\n    } else {\n      resolvePatients(\n        this.props.serverRootURL,\n        this.props.bearerToken,\n        resource,\n      ).then(this.props.setPatients);\n    }\n  }\n\n  render() {\n    const lists = this.state.groups;\n    // TODO: group the characteristics selections into one function.\n    const locations = getRefsFrom(lists, 'at-location');\n    const orgs = getRefsFrom(lists, 'attributed-to-organization');\n    const docs = getRefsFrom(lists, 'attributed-to-practitioner');\n    const careTeams = getRefsFrom(lists, 'attributed-to-careteam');\n    // TODO: get the component selections, saving them into an object.\n    // TODO: also collect Orgs and Docs from the ManagingEntity field (either should work).\n    if (debug) {\n      console.log('render selections from', locations, orgs, docs, careTeams);  // XXX\n    }\n    const selections = [];\n\n    // TODO: pass in a hook state for the selectedList and a setter.  This will allow a data refresh to\n    //       un-select the current selected list (which would be needed when changing servers).\n\n    // NICE: turn this into a NavBar: https://blueprintjs.com/docs/#core/components/navbar followed by a scrollable ListSelector\n    return (\n      <>\n        <div style={{ fontWeight: 'bold' }} >\n          Patient Lists ({this.state.groups ? this.state.groups.length : 0})\n        </div>\n        <div style={{ overflowY: 'scroll' }} >\n          <ListSelector\n            handleListSelection={this.handleListSelection}\n            lists={filterLists(lists, selections)}\n            serverRootURL={this.props.serverRootURL}\n            bearerToken={this.props.bearerToken}\n          />\n        </div>\n      </>\n    );\n  }\n}\n\nexport default ListsPanel;","import React from 'react';\nimport 'components/DeveloperPanel.css'\nimport { Button, Callout, Collapse } from \"@blueprintjs/core\";\n\n// NICE: enable this panel to be resized up and down.\n\nexport default function DeveloperPanel(props) {\n  let messages = props.developerMessages || <pre key=\"0\">None</pre>;\n  const [isHidden, setIsHidden] = React.useState(true);\n\n  return (\n    <>\n      <Button\n        onClick={() => {setIsHidden(!isHidden)}}\n        style={{zIndex: 1, position: 'relative'}}\n      >\n        {isHidden ? \"Show\" : \"Hide\"} Developer Messages\n      </Button>\n      <Collapse isOpen={!isHidden}>\n        <Callout title=\"Developer Messages (Most Recent At Top)\">\n          <div style={{overflowY: 'scroll'}}>\n            {messages}\n          </div>\n        </Callout>\n      </Collapse>\n    </>\n  );\n}\n","import React from 'react';\nimport 'components/PatientsPanel.css'\nimport { HTMLTable } from '@blueprintjs/core';\n\n// TODO: decide how to enable the on-hover data for patients, just like in the lists panel\n\nfunction getRow(patient, attributeGetters) {\n  return attributeGetters.map(getter => getter[1](patient));\n}\n\nfunction getData(patients, attributeGetters) {\n  return patients.map(patient => getRow(patient, attributeGetters));\n}\n\nfunction getName(patient) {\n  if (patient && patient.name) {\n    const officialNames = patient.name.filter(name => name.use === 'official');\n    if (officialNames.length) {\n      const name = officialNames[0];\n      const names = name.given.map(fn => `${fn} ${name.family}`);\n      if (names.length) {\n        return names[0].replace(/[0-9]/g, '');\n      }\n    }\n  }\n  return 'J. Doe';\n}\n\nfunction getAge(patient) {\n  const ageMs = Date.now() - Date.parse(patient.birthDate);\n  return Math.trunc(new Date(ageMs).getUTCFullYear() - 1970);\n}\n\nconst patientAttributeGetters = [\n  ['ID', p => p.id],\n  ['Name', getName],\n  ['Age', getAge],\n  ['Sex', p => p.gender === 'female' ? 'F' : 'M'],\n];\n\nexport default function PatientsPanel(props) {\n  const getters = [...patientAttributeGetters, ...props.extraAttributeGetters];\n  const columns = getters.map(x => x[0]);\n  return (\n    <>\n      <div style={{ fontWeight: 'bold' }} >\n        Patients ({props.patients.length} selected)\n      </div>\n      <span style={{ overflowY: 'scroll' }} >\n        <HTMLTable condensed={true} interactive={true}>\n          <thead>\n            <tr key=\"patientsPanelHeaders\">{columns.slice(1).map(x =>\n              <th key={x}>{x}</th>\n            )}</tr>\n          </thead>\n          <tbody>\n            {getData(props.patients, getters).map(row =>\n              <tr key={`patientsPanelPatient/${row[0]}`}>{row.slice(1).map((col, i) =>\n                <td key={`Patient/${row[0]}/${i}`}>{col}</td>\n              )}</tr>\n            )}\n          </tbody>\n        </HTMLTable>\n      </span>\n    </>\n  );\n}\n","import React from 'react';\nimport 'components/AttributesPanel.css'\nimport { Checkbox, HTMLTable } from '@blueprintjs/core';\n\n// NICE: reveal this panel by clicking a Button.\n\nfunction getConditions(patient) {\n  return ['Asthma', 'Fibromyalgia', 'Cancer'];\n}\n\nfunction getLatestEncounter(patient) {\n  return '2020-08-21';\n}\n\nfunction getLastImmunization(patient) {\n  return '2019-12-26';\n}\n\nfunction getLocation(patient) {\n  return 'Ward 1';\n}\n\nfunction getPCP(patient) {\n  // TODO: implement this\n  return 'Dr. Doe';\n}\n\nconst extraAttributeGetters = [\n  ['Conditions', getConditions],\n  ['Current Location', getLocation],\n  ['Last Immunization', getLastImmunization],\n  ['Latest Encounter', getLatestEncounter],\n  ['PCP', getPCP],\n];\n\n// TODO: decide what the tooltip will contain when hovering over the row.\nexport default function ExtraAttributesPanel(props) {\n  // Applies the changes.\n  function handleAttributeSelected(event, what) {\n    const setColumns = props.setExtraAttributeGetters;\n    if (event.target.checked) {\n      setColumns([...props.extraAttributeGetters, what]);\n    } else {\n      setColumns(props.extraAttributeGetters.filter(x => x[0] !== what[0]));\n    }\n  }\n\n  return (\n    <>\n      <div style={{ fontWeight: 'bold' }} >\n        Extra Attributes\n      </div>\n      <span style={{ overflowY: 'scroll' }} >\n        <HTMLTable condensed={true}>\n          <tbody>\n            {extraAttributeGetters\n              .map(x =>\n                <tr key={x[0]}>\n                  <td>\n                    <Checkbox\n                      onChange={(e) => handleAttributeSelected(e, x)}\n                      checked={props.isChecked}\n                    >\n                      {x[0]}\n                    </Checkbox>\n                  </td>\n                </tr>\n              )\n            }\n          </tbody>\n        </HTMLTable>\n      </span>\n    </>\n  );\n}\n","import React, {useState} from 'react';\nimport HeaderPanel from 'components/HeaderPanel';\nimport ListsPanel from 'components/ListsPanel';\nimport DeveloperPanel from 'components/DeveloperPanel';\nimport PatientsPanel from 'components/PatientsPanel';\nimport ExtraAttributesPanel from 'components/AttributesPanel';\n\nimport './App.css';\nimport \"normalize.css\";\nimport '@blueprintjs/icons/lib/css/blueprint-icons.css';\nimport '@blueprintjs/core/lib/css/blueprint.css';\nimport '@blueprintjs/select/lib/css/blueprint-select.css';\n\n// TODO: update this with the public-facing URL, when it's available.\n//const defaultServerRootURL = \"http://localhost:8080/hapi-fhir-jpaserver/fhir/\";\nconst defaultServerRootURL = 'https://hapi.fhir.org/baseR4/';\nconst defaultTagSystem = 'http://hl7.org/Connectathon'\nconst defaultTagCode = '2020-Sep'\n\nfunction App() {\n  const [developerMessages, setDeveloperMessages] = useState([]);\n  const [extraAttributeGetters, setExtraAttributeGetters] = useState([]);\n  const [patients, setPatients] = useState([]);\n  const [serverRootURL, setServerRootURL] = useState(defaultServerRootURL);\n  const [bearerToken, setBearerToken] = useState('');\n  const [tagSystem, setTagSystem] = useState(defaultTagSystem);\n  const [tagCode, setTagCode] = useState(defaultTagCode);\n  const [requireSummaryDiscovery, setRequireSummaryDiscovery] = useState(true);\n\n  React.useEffect(() => {\n    const message = (\n      <pre key={Date.now()}>Updated FHIR Server root to: {serverRootURL}</pre>\n    );\n    setDeveloperMessages(d => [message, ...d]);\n  }, [serverRootURL]);\n\n  return (\n    <div className=\"App\">\n      <div className=\"row\">\n        <div className=\"top\">\n          <HeaderPanel\n            bearerToken={bearerToken}\n            developerMessages={developerMessages}\n            requireSummaryDiscovery={requireSummaryDiscovery}\n            serverRootURL={serverRootURL}\n            setBearerToken={setBearerToken}\n            setDeveloperMessages={setDeveloperMessages}\n            setRequireSummaryDiscovery={setRequireSummaryDiscovery}\n            setServerRootURL={setServerRootURL}\n            setTagCode={setTagCode}\n            setTagSystem={setTagSystem}\n            tagCode={tagCode}\n            tagSystem={tagSystem}\n          /></div>\n      </div>\n\n      <div className=\"row\">\n        <div className=\"left\">\n          <ListsPanel\n            bearerToken={bearerToken}\n            developerMessages={developerMessages}\n            requireSummaryDiscovery={requireSummaryDiscovery}\n            serverRootURL={serverRootURL}\n            setDeveloperMessages={setDeveloperMessages}\n            setPatients={setPatients}\n            tagCode={tagCode}\n            tagSystem={tagSystem}\n          />\n        </div>\n        <div className=\"center\">\n          <PatientsPanel\n            bearerToken={bearerToken}\n            extraAttributeGetters={extraAttributeGetters}\n            patients={patients}\n            setDeveloperMessages={setDeveloperMessages}\n          />\n        </div>\n        <div className=\"right\">\n          <ExtraAttributesPanel\n            bearerToken={bearerToken}\n            extraAttributeGetters={extraAttributeGetters}\n            setExtraAttributeGetters={setExtraAttributeGetters}\n          />\n        </div>\n      </div>\n\n      <div className=\"row\">\n        <div className=\"bottom\">\n          <DeveloperPanel\n            developerMessages={developerMessages}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\n// Returns a DemoApp either in strict or 'normal' mode.\nfunction DemoApp(props) {\n  if (props.strict) {\n    return (\n      <React.StrictMode>\n        <App />\n      </React.StrictMode>\n    );\n  }\n  return <App />;\n}\n\nReactDOM.render(\n  <DemoApp strict={false} />,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}