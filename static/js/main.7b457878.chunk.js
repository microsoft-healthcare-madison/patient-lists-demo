(this["webpackJsonppatient-lists-demo"]=this["webpackJsonppatient-lists-demo"]||[]).push([[0],{135:function(e,t,r){e.exports=r(180)},140:function(e,t,r){},141:function(e,t,r){},172:function(e,t,r){},173:function(e,t,r){},174:function(e,t,r){},175:function(e,t,r){},180:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(13),c=r.n(o),s=(r(140),r(16)),l=r(6),i=r(42),u=r(43),p=r(46),m=r(45),f=(r(141),r(9));function h(e){var t=a.a.useState(e.serverRootURL),r=Object(l.a)(t,2),n=r[0],o=r[1],c=a.a.useState(!0),s=Object(l.a)(c,2),i=s[0],u=s[1],p=a.a.useState(e.tagSystem),m=Object(l.a)(p,2),h=m[0],d=m[1],v=a.a.useState(e.tagCode),g=Object(l.a)(v,2),b=g[0],y=g[1],E=a.a.useState(!1),k=Object(l.a)(E,2),S=k[0],R=k[1],j=a.a.useState(!1),C=Object(l.a)(j,2),O=C[0],T=C[1],L=a.a.useState(""),w=Object(l.a)(L,2),D=w[0],U=w[1],x=a.a.createElement(f.Tooltip,{content:"".concat(O?"Hide":"Show"," Token")},a.a.createElement(f.Button,{icon:O?"unlock":"lock",minimal:!0,onClick:function(){return T(!O)}}));return a.a.createElement(a.a.Fragment,null,a.a.createElement(f.Button,{onClick:function(){R(!S)}},S?"Hide":"Show"," Settings"),a.a.createElement(f.Collapse,{isOpen:S,keepChildrenMounted:!0},a.a.createElement("form",{className:"server",onSubmit:function(t){t.preventDefault(),e.setServerRootURL(n),e.setTagCode(b),e.setTagSystem(h),e.setBearerToken(D)}},a.a.createElement("label",null,"FHIR Server Root"),"\xa0",a.a.createElement("input",{className:"url",type:"text",value:n,onChange:function(e){var t=e.target.value.trim();o(t);try{new URL(t);var r=(t+"/metadata").replace(/([^:]\/)\/+/g,"$1");fetch(r).then((function(){return u(!0)})).catch((function(){return u(!1)}))}catch(n){u(!1)}}}),a.a.createElement("br",null),a.a.createElement("br",null),a.a.createElement("label",null,"Authentication"),a.a.createElement("table",null,a.a.createElement("tbody",null,a.a.createElement("tr",null,a.a.createElement("td",null,"Bearer Token")),a.a.createElement("tr",null,a.a.createElement("td",null,a.a.createElement(f.InputGroup,{placeholder:"Enter a bearer token...",rightElement:x,type:O?"text":"token",onInput:function(e){U(e.target.value)}}))))),a.a.createElement("br",null),a.a.createElement("br",null),a.a.createElement("label",null,"Data Tag"),a.a.createElement("table",null,a.a.createElement("tbody",null,a.a.createElement("tr",null,a.a.createElement("td",null,a.a.createElement("label",null,"system")),a.a.createElement("td",null,a.a.createElement("input",{className:"url",type:"text",value:h,onChange:function(e){d(e.target.value.trim())}}))),a.a.createElement("tr",null,a.a.createElement("td",null,a.a.createElement("label",null,"code")),a.a.createElement("td",null,a.a.createElement("input",{type:"text",value:b,onChange:function(e){y(e.target.value.trim())}}))))),a.a.createElement(f.Button,{type:"submit",disabled:!i},"Apply"))))}var d=function(e){Object(p.a)(r,e);var t=Object(m.a)(r);function r(){return Object(i.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement("span",{className:"app-title"},"Patient Lists Demo App"),a.a.createElement(h,{bearerToken:this.props.bearerToken,developerMessages:this.props.developerMessages,serverRootURL:this.props.serverRootURL,setBearerToken:this.props.setBearerToken,setDeveloperMessages:this.props.setDeveloperMessages,setServerRootURL:this.props.setServerRootURL,setTagCode:this.props.setTagCode,setTagSystem:this.props.setTagSystem,tagCode:this.props.tagCode,tagSystem:this.props.tagSystem}))}}]),r}(a.a.Component),v=r(44),g=r(33),b=r.n(g),y=r(52);function E(e,t){var r=function(e){return e&&e.entry?e.entry.map((function(e){return e.resource})).filter(Boolean):[]}(e);if(!r)return[];var n=function(e,t){return e.flatMap((function(e){return e.characteristic})).filter(Boolean).filter((function(e){return e.code&&e.code.coding&&e.code.coding.some((function(e){return"http://argonautproject.org/patient-lists/CodeSystem/characteristics"===e.system&&e.code===t}))}))}(r,t),a=new Set(n.map((function(e){return e.valueReference.reference})));return Object(s.a)(a).sort()}function k(e,t,r){return S.apply(this,arguments)}function S(){return(S=Object(y.a)(b.a.mark((function e(t,r,n){var a,o,c,l,i,u,p,m;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],o=new URL(t).protocol,c=t.replace(/([^:]\/)\/+/g,"$1"),l={headers:{Authorization:"Bearer ".concat(r)}};case 4:return(i=new URL(c)).protocol!==o&&(console.warn("\n        Unexpected change of protocol when draining a resource URL!!!\n        Server at ".concat(i.host," changed from ").concat(o," to ").concat(i.protocol,".\n        Reverting protocol back to ").concat(o,"!\n      ").replace(/\s+/g," ").trim()),i.protocol=o,c=i.href),e.next=8,fetch(c,r?l:void 0).then((function(e){return e.json()})).then((function(e){return a.push(e)}));case 8:if("Bundle"===(u=a.pop()).resourceType){e.next=11;break}return e.abrupt("return",u);case 11:u.entry||(u.entry=[]),p=u.link.filter((function(e){return"next"===e.relation})),c=p.length?p[0].url:void 0,0===a.length?a.push(u):(m=a[0].entry).push.apply(m,Object(s.a)(u.entry)),n&&a.length&&a[0].entry&&n(a[0].entry.length,a[0].total);case 16:if(c){e.next=4;break}case 17:return e.abrupt("return",a[0]);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e,t){if(!e)return[];var r=Object(s.a)(e);return t.length&&console.warn("Not Implemented yet: api.filterLists",t),r.sort((function(e,t){var r=e.resource.name||"",n=t.resource.name||"";return r.localeCompare(n)}))}function j(e,t,r){function n(){return(n=Object(y.a)(b.a.mark((function r(n){return b.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",k(e+"/"+n,t));case 1:case"end":return r.stop()}}),r)})))).apply(this,arguments)}var a=r.member?r.member:[],o=Object(s.a)(new Set(a.map((function(e){if(e&&e.entity)return e.entity.reference;console.warn("api.resolvePatients.getReference: unknown reference type in:",r,e)})).filter((function(e){return e})))).map((function(e){return function(e){return n.apply(this,arguments)}(e)}));return Promise.all(o)}function C(e){var t=e.resource,r="".concat(t.resourceType,"/").concat(t.id),n=e.display||r,o=!e.getHoverData,c=a.a.createElement("table",null);return e.getHoverData&&(c=a.a.createElement("table",null,a.a.createElement("tbody",null,e.getHoverData(t).map((function(e){var t=Object(l.a)(e,2),n=t[0],o=t[1];return a.a.createElement("tr",{key:"".concat(r,".").concat(n)},a.a.createElement("td",{style:{fontWeight:"bold"}},n),a.a.createElement("td",null,o))}))))),a.a.createElement(f.Tooltip,{content:c,disabled:o,transitionDuration:100,intent:"primary",boundary:"viewport",hoverCloseDelay:1e3,enforceFocus:!1},a.a.createElement("span",null,n))}function O(e){var t=a.a.useState(),r=Object(l.a)(t,2),n=r[0],o=r[1];if(!e.lists)return a.a.createElement(a.a.Fragment,null);return a.a.createElement(f.RadioGroup,{onChange:function(t){var r;o(t.target.value),e.handleListSelection((r=t.target.value,e.lists.filter((function(e){return"Group/".concat(e.resource.id)===r}))[0]).resource)},selectedValue:n},e.lists.map((function(t){return function(e){var t=e.resource,r="".concat(t.resourceType,"/").concat(t.id);return a.a.createElement(f.Radio,{key:r,value:r},a.a.createElement(C,{display:t.name,resource:t,getHoverData:function(t){return[["reference",a.a.createElement("a",{href:encodeURI("".concat(e.serverRootURL,"/").concat(r)),style:{color:"yellow"},rel:"noopener noreferrer",target:"_blank"},r)],["actual",t.actual?"true":"false"],["type",t.type],["members",t.member?t.member.length:"?"]]}}))}({handleListSelection:e.handleListSelection,resource:t.resource,serverRootURL:e.serverRootURL})})))}var T=function(e){Object(p.a)(r,e);var t=Object(m.a)(r);function r(e){var n;return Object(i.a)(this,r),(n=t.call(this,e)).state={serverRoot:e.serverRootURL,bearerToken:e.bearerToken,tagCode:e.tagCode,tagSystem:e.tagSystem},n.handleListSelection=n.handleListSelection.bind(Object(v.a)(n)),n}return Object(u.a)(r,[{key:"progressCallback",value:function(e,t,r){0}},{key:"getRefreshQueryUrl",value:function(e,t){var r=[];this.props.tagSystem&&this.props.tagCode&&r.push(["_tag","".concat(this.props.tagSystem,"|").concat(this.props.tagCode)]),t&&t.length&&r.push.apply(r,Object(s.a)(t.map((function(e){return["_include",e]}))));var n=r.map((function(e){return e.map(encodeURIComponent).join("=")})).join("&"),a=n?"?".concat(n):"";return"".concat(this.props.serverRootURL,"/").concat(e).concat(a)}},{key:"getDiscoveryUrl",value:function(){var e=[["_summary","true"]];this.props.tagSystem&&this.props.tagCode&&e.push(["_tag","".concat(this.props.tagSystem,"|").concat(this.props.tagCode)]);var t=e.map((function(e){return e.map(encodeURIComponent).join("=")})).join("&"),r=t?"?".concat(t):"";return"".concat(this.props.serverRootURL,"/Group").concat(r)}},{key:"refreshResources",value:function(e,t,r,n){var a=this;k(this.getRefreshQueryUrl(e,r),this.props.bearerToken,(function(t,r){a.progressCallback(e,t,r)})).then((function(r){var o={},c=r.entry.filter((function(t){return t.resource.resourceType===e})),s=r.entry.filter((function(t){return t.resource.resourceType!==e}));o[t]=c,o["".concat(t,"Included")]=s,n&&c.map((function(t){return n(e,t)})),a.setState(o)}))}},{key:"discoverLists",value:function(){var e=this;k(this.getDiscoveryUrl(),this.props.bearerToken).then((function(t){return e.setState({groups:t.entry})}))}},{key:"refreshData",value:function(){this.props.setPatients([]),this.props.requireSummaryDiscovery?this.discoverLists():this.refreshResources("Group","groups"),this.refreshResources("Location","locations")}},{key:"componentDidMount",value:function(){this.refreshData()}},{key:"componentDidUpdate",value:function(){(this.state.serverRoot!==this.props.serverRootURL||this.state.bearerToken!==this.props.bearerToken||this.state.tagCode!==this.props.tagCode||this.state.tagSystem!==this.props.tagSystem)&&(this.refreshData(),this.setState({serverRoot:this.props.serverRootURL,bearerToken:this.props.bearerToken,tagCode:this.props.tagCode,tagSystem:this.props.tagSystem}))}},{key:"handleListSelection",value:function(e){var t=this;k("".concat(this.props.serverRootURL,"/Group/").concat(e.id),this.props.bearerToken).then((function(e){return j(t.props.serverRootURL,t.props.bearerToken,e).then(t.props.setPatients)}))}},{key:"render",value:function(){var e=this.state.groups;E(e,"at-location"),E(e,"attributed-to-organization"),E(e,"attributed-to-practitioner"),E(e,"attributed-to-careteam");return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{style:{fontWeight:"bold"}},"Patient Lists (",this.state.groups?this.state.groups.length:0,")"),a.a.createElement("div",{style:{overflowY:"scroll"}},a.a.createElement(O,{handleListSelection:this.handleListSelection,lists:R(e,[]),serverRootURL:this.props.serverRootURL,bearerToken:this.props.bearerToken})))}}]),r}(a.a.Component);r(172);function L(e){var t=e.developerMessages||a.a.createElement("pre",{key:"0"},"None"),r=a.a.useState(!0),n=Object(l.a)(r,2),o=n[0],c=n[1];return a.a.createElement(a.a.Fragment,null,a.a.createElement(f.Button,{onClick:function(){c(!o)},style:{zIndex:1,position:"relative"}},o?"Show":"Hide"," Developer Messages"),a.a.createElement(f.Collapse,{isOpen:!o},a.a.createElement(f.Callout,{title:"Developer Messages (Most Recent At Top)"},a.a.createElement("div",{style:{overflowY:"scroll"}},t))))}r(173);var w=[["ID",function(e){return e.id}],["Name",function(e){if(e&&e.name){var t=e.name.filter((function(e){return"official"===e.use}));if(t.length){var r=t[0],n=r.given.map((function(e){return"".concat(e," ").concat(r.family)}));if(n.length)return n[0].replace(/[0-9]/g,"")}}return"J. Doe"}],["Age",function(e){var t=Date.now()-Date.parse(e.birthDate);return Math.trunc(new Date(t).getUTCFullYear()-1970)}],["Sex",function(e){return"female"===e.gender?"F":"M"}]];function D(e){var t,r,n=[].concat(w,Object(s.a)(e.extraAttributeGetters)),o=n.map((function(e){return e[0]}));return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{style:{fontWeight:"bold"}},"Patients (",e.patients.length," selected)"),a.a.createElement("span",{style:{overflowY:"scroll"}},a.a.createElement(f.HTMLTable,{condensed:!0,interactive:!0},a.a.createElement("thead",null,a.a.createElement("tr",{key:"patientsPanelHeaders"},o.slice(1).map((function(e){return a.a.createElement("th",{key:e},e)})))),a.a.createElement("tbody",null,(t=e.patients,r=n,t.map((function(e){return function(e,t){return t.map((function(t){return t[1](e)}))}(e,r)}))).map((function(e){return a.a.createElement("tr",{key:"patientsPanelPatient/".concat(e[0])},e.slice(1).map((function(t,r){return a.a.createElement("td",{key:"Patient/".concat(e[0],"/").concat(r)},t)})))}))))))}r(174);var U=[["Conditions",function(e){return["Asthma","Fibromyalgia","Cancer"]}],["Current Location",function(e){return"Ward 1"}],["Last Immunization",function(e){return"2019-12-26"}],["Latest Encounter",function(e){return"2020-08-21"}],["PCP",function(e){return"Dr. Doe"}]];function x(e){return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{style:{fontWeight:"bold"}},"Extra Attributes"),a.a.createElement("span",{style:{overflowY:"scroll"}},a.a.createElement(f.HTMLTable,{condensed:!0},a.a.createElement("tbody",null,U.map((function(t){return a.a.createElement("tr",{key:t[0]},a.a.createElement("td",null,a.a.createElement(f.Checkbox,{onChange:function(r){return function(t,r){var n=e.setExtraAttributeGetters;t.target.checked?n([].concat(Object(s.a)(e.extraAttributeGetters),[r])):n(e.extraAttributeGetters.filter((function(e){return e[0]!==r[0]})))}(r,t)},checked:e.isChecked},t[0])))}))))))}r(175),r(176),r(177),r(178),r(179);var M=function(){var e=Object(n.useState)([]),t=Object(l.a)(e,2),r=t[0],o=t[1],c=Object(n.useState)([]),i=Object(l.a)(c,2),u=i[0],p=i[1],m=Object(n.useState)([]),f=Object(l.a)(m,2),h=f[0],v=f[1],g=Object(n.useState)("https://hapi.fhir.org/baseR4/"),b=Object(l.a)(g,2),y=b[0],E=b[1],k=Object(n.useState)(""),S=Object(l.a)(k,2),R=S[0],j=S[1],C=Object(n.useState)("http://hl7.org/Connectathon"),O=Object(l.a)(C,2),w=O[0],U=O[1],M=Object(n.useState)("2020-Sep"),A=Object(l.a)(M,2),N=A[0],B=A[1],P=Object(n.useState)(!0),G=Object(l.a)(P,2),I=G[0],F=G[1];return a.a.useEffect((function(){var e=a.a.createElement("pre",{key:Date.now()},"Updated FHIR Server root to: ",y);o((function(t){return[e].concat(Object(s.a)(t))}))}),[y]),a.a.createElement("div",{className:"App"},a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"top"},a.a.createElement(d,{bearerToken:R,developerMessages:r,requireSummaryDiscovery:I,serverRootURL:y,setBearerToken:j,setDeveloperMessages:o,setRequireSummaryDiscovery:F,setServerRootURL:E,setTagCode:B,setTagSystem:U,tagCode:N,tagSystem:w}))),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"left"},a.a.createElement(T,{bearerToken:R,developerMessages:r,requireSummaryDiscovery:I,serverRootURL:y,setDeveloperMessages:o,setPatients:v,tagCode:N,tagSystem:w})),a.a.createElement("div",{className:"center"},a.a.createElement(D,{bearerToken:R,extraAttributeGetters:u,patients:h,setDeveloperMessages:o})),a.a.createElement("div",{className:"right"},a.a.createElement(x,{bearerToken:R,extraAttributeGetters:u,setExtraAttributeGetters:p}))),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"bottom"},a.a.createElement(L,{developerMessages:r}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function A(e){return e.strict?a.a.createElement(a.a.StrictMode,null,a.a.createElement(M,null)):a.a.createElement(M,null)}c.a.render(a.a.createElement(A,{strict:!1}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[135,1,2]]]);
//# sourceMappingURL=main.7b457878.chunk.js.map